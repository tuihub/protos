syntax = "proto3";

package librarian.sephirah.v1;

import "google/protobuf/duration.proto";
import "google/protobuf/timestamp.proto";
import "librarian/v1/common.proto";

option csharp_namespace = "TuiHub.Protos.Librarian.Sephirah.V1";
option go_package = "github.com/tuihub/protos/pkg/librarian/sephirah/v1;v1";

message CreateFeedConfigRequest {
  FeedConfig config = 1;
}
message CreateFeedConfigResponse {
  librarian.v1.InternalID id = 1;
}

message UpdateFeedConfigRequest {
  FeedConfig config = 1;
}
message UpdateFeedConfigResponse {}

message ListFeedsRequest {
  librarian.v1.PagingRequest paging = 1;
  repeated librarian.v1.InternalID id_filter = 2;
  repeated librarian.v1.InternalID author_id_filter = 3;
  repeated FeedConfigSource source_filter = 4;
  repeated FeedConfigStatus status_filter = 5;
}

message ListFeedsResponse {
  librarian.v1.PagingResponse paging = 1;
  repeated FeedWithConfig feeds_with_config = 2;
  message FeedWithConfig {
    librarian.v1.Feed feed = 1;
    FeedConfig config = 2;
  }
}

message ListFeedItemsRequest {
  librarian.v1.PagingRequest paging = 1;
  repeated librarian.v1.InternalID feed_id_filter = 2;
  repeated librarian.v1.InternalID author_id_filter = 3;
  repeated string publish_platform_filter = 4;
}

message ListFeedItemsResponse {
  librarian.v1.PagingResponse paging = 1;
  repeated FeedItemIDWithFeedID items = 2;
  message FeedItemIDWithFeedID {
    librarian.v1.InternalID feed_id = 1;
    librarian.v1.InternalID item_id = 2;
  }
}

message GetFeedItemRequest {
  librarian.v1.InternalID id = 1;
}

message GetFeedItemResponse {
  librarian.v1.FeedItem item = 1;
}

message GetBatchFeedItemsRequest {
  repeated librarian.v1.InternalID ids = 1;
}

message GetBatchFeedItemsResponse {
  repeated librarian.v1.FeedItem items = 1;
}

message FeedConfig {
  librarian.v1.InternalID id = 1;
  string feed_url = 2;
  librarian.v1.InternalID author_account = 3;
  FeedConfigSource source = 4;
  FeedConfigStatus status = 5;
  google.protobuf.Duration pull_interval = 6;
  // response only
  optional google.protobuf.Timestamp latest_pull_time = 7;
}

enum FeedConfigStatus {
  FEED_CONFIG_STATUS_UNSPECIFIED = 0;
  FEED_CONFIG_STATUS_ACTIVE = 1;
  FEED_CONFIG_STATUS_SUSPEND = 2;
}

enum FeedConfigSource {
  FEED_CONFIG_SOURCE_UNSPECIFIED = 0;
  FEED_CONFIG_SOURCE_COMMON = 1;
}
