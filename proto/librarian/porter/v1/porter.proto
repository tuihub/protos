syntax = "proto3";

package librarian.porter.v1;

import "librarian/v1/common.proto";

option csharp_namespace = "TuiHub.Protos.Librarian.Porter.V1";
option go_package = "github.com/tuihub/protos/pkg/librarian/porter/v1;v1";

/*
 * The main role of Porter is to encapsulate input&output operations.
 * In Porter's model:
 * - The data interface is divided into four types: feed, db, wiki, and data. 
     Any input and output can be assigned to a specific type.
 * 1. Feed is the most structured type and basically refers to the RSS 2.0
 * 2. DB can be structured but the content requires additional processing
 * 3. Wiki cannot be structured
 * 4. Data can represent the binary and metadata of specific files
 */
service LibrarianPorterService {
  rpc PullFeed(PullFeedRequest) returns (PullFeedResponse);
  rpc PullDB(PullDBRequest) returns (PullDBResponse);
  rpc PullWiki(PullWikiRequest) returns (PullWikiResponse);
  rpc PullData(PullDataRequest) returns (stream PullDataResponse);
  rpc PullAccount(PullAccountRequest) returns (PullAccountResponse);
  rpc PullApp(PullAppRequest) returns (PullAppResponse);
  rpc PullAccountAppRelation(PullAccountAppRelationRequest) returns (PullAccountAppRelationResponse);
  rpc PushData(stream PushDataRequest) returns (PushDataResponse);
}

message PullFeedRequest {
  FeedSource source = 1;
  string content_id = 2;
}

message PullFeedResponse {
  optional librarian.v1.Feed data = 1;
}

message PullDBRequest {
  DBSource source = 1;
  string content_id = 2;
}
message PullDBResponse {
  map<string, string> data = 1;
}

message PullWikiRequest {
  DBSource source = 1;
  string content_id = 2;
}
message PullWikiResponse {
  string data = 1;
}

message PullDataRequest {
  DataSource source = 1;
  string content_id = 2;
}
message PullDataResponse {
  bytes data = 1;
}

message PullAccountRequest {
  librarian.v1.AccountID account_id = 1;
}

message PullAccountResponse {
  librarian.v1.Account account = 1;
}

message PullAppRequest {
  librarian.v1.AppID app_id = 1;
}

message PullAppResponse {
  librarian.v1.App app = 1;
}

message PullAccountAppRelationRequest {
  AccountAppRelationType relation_type = 1;
  librarian.v1.AccountID account_id = 2;
}

message PullAccountAppRelationResponse {
  repeated librarian.v1.App app_list = 1;
}

message PushDataRequest {
  DataSource source = 1;
  string content_id = 2;
  bytes data = 3;
}
message PushDataResponse {}

enum AccountAppRelationType {
  ACCOUNT_APP_RELATION_TYPE_UNSPECIFIED = 0;
  ACCOUNT_APP_RELATION_TYPE_OWN = 1;
}

enum FeedSource {
  FEED_SOURCE_UNSPECIFIED = 0;
}

enum DBSource {
  DB_SOURCE_UNSPECIFIED = 0;
}

enum WikiSource {
  WIKI_SOURCE_UNSPECIFIED = 0;
}

enum DataSource {
  DATA_SOURCE_UNSPECIFIED = 0;
}
